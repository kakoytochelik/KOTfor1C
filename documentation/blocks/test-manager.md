# Блок: Test Manager

## Задача блока

Test Manager (`Менеджер тестов`, бывш. Phase Switcher) управляет тем, какие главные сценарии участвуют в сборке и запуске, и показывает текущее состояние по каждому тесту.

## Что пользователь видит

- Дерево групп и тестов.
- Вкладки `Main` (`Главные`) и `Favorites` (`Избранное`).
- Чекбоксы включения/выключения тестов.
- Кнопки `Build tests` (`Собрать тесты`) и `Cancel build` (`Отменить сборку`).
- Поиск по главным сценариям (кнопка-лупа в шапке).
- Кнопки запуска/лога рядом со сценариями.

## Основные возможности

### Управление группами и тестами

- Включение/выключение тестов поштучно.
- Массовое включение по группе.
- Выбор чекбоксов сразу сохраняется и используется при сборке.
- Переименование группы через контекстное меню.
- Переименование сценария через контекстное меню.

### Поиск по сценариям

- Включается кнопкой с лупой в шапке Test Manager (`Менеджер тестов`).
- Подсветка совпадений активна, пока фокус находится в поле поиска.
- Во время поиска подсветка связанных сценариев временно отключается, чтобы не мешать навигации.

### Статусы запуска

Для каждого сценария отображается актуальный status:

- `running` — тест в процессе;
- `passed` — успешное завершение. Дополнительно имеет stale состояние, если запускался устаревший тест;
- `failed` — ошибка выполнения;
- `stale` — сборка устарела (после изменений в связанных сценариях).

### Избранное

- Добавление/удаление сценария в избранное.
- Сортировка списка.
- Открытие сценария по клику.
- Drag-and-drop в редактор для вставки вызова вложенного сценария с параметрами.

### Подсветка влияния

Если открыт сценарий в редакторе, Test Manager (`Менеджер тестов`) может подсвечивать главные сценарии, на которые он влияет по цепочке вызовов.

## Настройки блока

| Настройка | Назначение |
|---|---|
| `kotTestToolkit.phaseSwitcher.highlightAffectedMainScenarios` | Включает подсветку затронутых главных сценариев |
| `kotTestToolkit.phaseSwitcher.autoAddNewScenariosToFavorites` | Автодобавление новых сценариев в избранное |
| `kotTestToolkit.assembleScript.showDriveFeatures` | Показать/скрыть 1C:Drive-специфичные элементы (`Build FL` и режим учета) |

## Типовые операции

1. Выбрать набор тестов по чекбоксам.
2. Нажать `Build tests` (`Собрать тесты`).
3. Запустить конкретный сценарий и смотреть статус/лог.

## Что важно учитывать

- Кнопки запуска зависят от артефактов последней сборки.
- После изменений в сценариях успешный/ошибочный статус может перейти в `stale`.
- Во время `running` повторный запуск этого же сценария блокируется.
- Для фильтрации сборки расширение автоматически подставляет `Exceptscenario` или `Scenariofilter` по выбранным чекбоксам.
