# Блок: Editor and IntelliSense

## Задача блока

Ускорить редактирование сценариев и снизить количество ручных ошибок в YAML и `feature`.

## Что входит в блок

### Автодополнение

- Подсказки шагов Gherkin из библиотеки `steps.htm` (это библиотека шагов Vanessa Automation, выгруженная в отдельный файл) — в YAML и `feature`.
- Семантический режим по префиксу `!`:
  - поиск по текстам и описаниям шагов;
  - приоритет языка подсказок шагов определяется тегом `#language:` в текущем сценарии.
- Подсказки вызовов вложенных сценариев из кеша проекта — в YAML и `feature`.
- Подсказки параметров вызова с подстановкой значений по умолчанию.
- Подсказки переменных при вводе `$...$`:
  - переменные, сохраненные выше по сценарию;
  - `GlobalVars` из Менеджера параметров.
  - доступны в YAML и `feature`.

### Hover-подсказки

- Для шагов: описание шага + пример с фактическими аргументами текущей строки (YAML и `feature`).
- Для вызовов сценариев: описание сценария, число параметров, вложенных вызовов и файлов (YAML и `feature`).
- Для упавших строк в `feature` обычный hover шага подавляется, чтобы приоритет имел hover ошибки.

### Автоформат при сохранении

- Замена табуляций пробелами.
- Выравнивание таблиц Gherkin.
- Выравнивание параметров вызовов по `=`.

### Автоподдержка служебных секций

- `ВложенныеСценарии` перезаполняется по фактическим вызовам в тексте.
- `ПараметрыСценария` перезаполняется по фактически используемым параметрам.
- Перезаполнение выполняется только при релевантных изменениях.

## Настройки блока

| Настройка | Назначение |
|---|---|
| `kotTestToolkit.editor.autoCollapseOnOpen` | Сворачивать служебные секции при открытии |
| `kotTestToolkit.editor.autoReplaceTabsWithSpacesOnSave` | Замена табов при save |
| `kotTestToolkit.editor.autoAlignNestedScenarioParametersOnSave` | Выравнивание параметров вызова |
| `kotTestToolkit.editor.autoAlignGherkinTablesOnSave` | Выравнивание таблиц |
| `kotTestToolkit.editor.autoFillNestedScenariosOnSave` | Автоподдержка `ВложенныеСценарии` |
| `kotTestToolkit.editor.autoFillScenarioParametersOnSave` | Автоподдержка `ПараметрыСценария` |
| `kotTestToolkit.editor.showRefillMessages` | Показывать уведомления о перезаполнении |
| `kotTestToolkit.editor.autoEnsureKotMetadataForMainScenarios` | Автодобавление/восстановление `KOTМетаданные` для всех типов сценариев |
| `kotTestToolkit.editor.enableLegacyMetadataMigrationForMainScenarios` | Опциональная миграция legacy-тегов `# PhaseSwitcher_*` в `KOTМетаданные` только для главных сценариев (под-настройка автообеспечения `KOTМетаданные`) |
| `kotTestToolkit.editor.newScenarioLanguage` | Язык новых сценариев (`#language`) |
| `kotTestToolkit.steps.externalUrl` | URL внешней библиотеки шагов |

## Практические советы

- Если скобки в тексте — это не параметр, используйте `\[` и `\]`.
- Для подстановки переменной начните ввод с `$` — список формируется из сохраненных и глобальных переменных.
- После обновления `steps.htm` выполните `KOT - Refresh steps library` (`KOT - Обновить библиотеку шагов`).
- Если обнаружены дубликаты кода сценария (поле `Код` в шапке), используйте соответствующую команду из `KOT - Редактирование`:
  - для главного сценария: `KOT - Изменить имя главного сценария`;
  - для вложенного сценария: `KOT - Изменить код вложенного сценария`.
