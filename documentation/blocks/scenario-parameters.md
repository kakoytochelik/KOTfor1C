# Параметры сценариев

Этот документ подробно описывает работу параметров в `ТекстСценария`, их объявление, передачу между вложенными сценариями и использование дефолтов.

## 1) Как объявить параметр

Параметры в тексте сценария задаются через квадратные скобки:

```yaml
ТекстСценария: |
    #language: en

    And I create sales invoice
    And I input [DocumentNumber] text in the field named "Number"
    And I input [Counterparty] text in the field named "Counterparty"
```

Если включено автозаполнение секций при сохранении, расширение автоматически поддерживает блок `ПараметрыСценария`.

## 2) Блок ПараметрыСценария и дефолты

Пример блока с дефолтными значениями:

```yaml
ПараметрыСценария:
    - ПараметрыСценария1:
        НомерСтроки: "1"
        Имя: "DocumentNumber"
        Значение: "000000001"
        ТипПараметра: "Строка"
        ИсходящийПараметр: "No"
    - ПараметрыСценария2:
        НомерСтроки: "2"
        Имя: "Counterparty"
        Значение: "Main Company"
        ТипПараметра: "Строка"
        ИсходящийПараметр: "No"
```

Если при вызове параметр не передан, используется `Значение` из блока `ПараметрыСценария`.

## 3) Передача параметров во вложенный сценарий

```yaml
ТекстСценария: |
    #language: en

    And Create sales invoice
        DocumentNumber = "000000123"
        Counterparty   = [Counterparty]
```

Поддерживается:

- строки в двойных кавычках;
- строки в одинарных кавычках;
- ссылка на параметр текущего контекста через `[ParamName]`.

## 4) Сквозная передача через несколько уровней

```yaml
# Главный сценарий вызывает Create sales invoice
And Create sales invoice
    DocumentNumber = "000000123"
    Counterparty   = "John Doe"

    # Внутри происходит вызов Prepare sale document
    And Prepare sale document
        DocNo = [DocumentNumber]

        # Внутри происходит вызов Fill document header
        And Fill document header
            Number = [DocNo]

            # Событие внутри Fill document header
            And I input [Number] text in the field named "Number"
```

В этом примере значение `DocumentNumber` проходит вниз по цепочке вызовов до шага ввода.

## 5) Quick Fix и диагностика

1. Если у вызова не хватает параметров, показывается предупреждение `Missing parameters`.
2. Quick fix может добавить отсутствующие параметры прямо в вызов.
3. Для добавляемых параметров берутся дефолты из `ПараметрыСценария` вызываемого сценария (если они есть).

## 6) Переменные `$...$` в автодополнении

При вводе `$` в блоке `ТекстСценария` доступны подсказки:

1. Переменные, сохраненные выше по текущему тексту сценария.
2. Переменные из вкладки `GlobalVars` в Менеджере параметров.

Шаги, из которых извлекаются переменные:

- EN:
  - `And I save "Value" in "VariableName" variable`
  - `And I save "Value" value to "VariableName" variable`
- RU:
  - `И Я запоминаю значение выражения "Value" в переменную "VariableName"`
  - `И Я запоминаю в переменную "Value" значение "VariableName"`

## 7) Важные правила

1. Имена параметров при вызове должны совпадать с именами в вызываемом сценарии.
2. Если квадратные скобки нужны как обычный текст, экранируйте их: `\[` и `\]`.
3. Один и тот же вложенный сценарий можно вызывать много раз с разными параметрами.
