# Quick Start

Цель этого гайда: за 10-15 минут дойти до рабочего цикла
`Создание и редактирование YAML -> сборка -> запуск в Vanessa`.

## 1) Установка и открытие проекта

1. Установите расширение `KOT for 1C` из Marketplace.
2. Откройте корень проекта в VS Code.
3. Если проект уже содержит сценарии, убедитесь, что они имеют формат теста (`ТипФайла: "Сценарий"`).

## 2) Минимально необходимые настройки

Откройте Настройки плагина в VS Code (можно открыть по шестеренке в верхней части панели Test Manager в Activity Bar) и задайте минимум:

| Настройка | Для чего нужна |
|---|---|
| `kotTestToolkit.paths.yamlSourceDirectory` | Папка YAML-сценариев (источник кеша, диагностики, списка тестов) |
| `kotTestToolkit.paths.oneCEnterpriseExe` | Путь к `1cv8.exe` / `1cestart` |
| `kotTestToolkit.paths.emptyInfobase` | Путь к пустой файловой ИБ для запуска обработок |
| `kotTestToolkit.paths.buildScenarioBddEpf` | Путь к обработке `СборкаТекстовСценариев.epf` |
| `kotTestToolkit.runVanessa.vanessaEpfPath` | Путь к `vanessa-automation.epf` |
| `kotTestToolkit.assembleScript.buildPath` | Куда сохранять результаты сборки |

Рекомендуется сразу указать также:

- `kotTestToolkit.startupParams.parameters`

Справка по параметрам обработки `СборкаТекстовСценариев` (СППР):  
[https://its.1c.ru/db/sppr2doc#content:124:hdoc](https://its.1c.ru/db/sppr2doc#content:124:hdoc)

### 2.1) Менеджер параметров (обязательно для сборки и запуска)

Откройте Менеджер параметров через панель Менеджер тестов (кнопка с иконкой json в шапке панели) или командой `KOT - Open Build Scenario Parameters Manager` (`KOT - Открыть Менеджер параметров Сборки Сценариев`).

Что важно знать:

1. Вкладка `SPPR build parameters` (`СППР`) формирует `.json` файл, который использует `СборкаТекстовСценариев`.
2. Вкладка `Additional Vanessa Automation parameters` (`Дополнительные параметры`) нужна для VAParams-ключей, которые не покрывает СППР. Сюда можно загрузить ваши собственные настройки Vanessa Automation.
3. Вкладка `GlobalVars` добавляет пользовательские глобальные переменные в параметры запуска.

Минимум на старте:

- убедитесь, что в СППР-вкладке заполнены основные параметры сборки;
- нажмите `Apply` (`Применить`) именно в Менеджере параметров перед первой сборкой.

## 3) Первый запуск панели

1. Откройте Activity Bar -> `KOT for 1C`.
2. Проверьте, что загрузились группы и сценарии.
3. При необходимости включите поиск по главным сценариям кнопкой с лупой в шапке Test Manager (`Менеджер тестов`).
4. Если это новый проект без готовых YAML-сценариев, пустой список на этом этапе — это нормально.
5. Если сценарии в проекте уже есть, но список пустой, проверьте `yamlSourceDirectory` и структуру `scen.yaml`.

## 4) Создание первых сценариев (если проект новый)

1. Создайте главный и вложенный сценарий через иконку "+" в шапке Менеджера тестов, или через команды:
   - `KOT - Create main scenario` (`KOT - Создать главный сценарий`) — из сценариев такого типа формируются итоговые `.feature` файлы при сборке.
   - `KOT - Create nested scenario` (`KOT - Создать вложенный сценарий`) — сценарии такого типа можно вызывать из других вложенных сценариев и из главных.
2. Что запросит мастер создания:
   - Для вложенного сценария:
     - имя сценария;
     - числовой код;
     - родительская папка, куда будет создана папка сценария.
   - Для главного сценария:
     - имя сценария (и имя папки);
     - имя группы в Test Manager (`Менеджер тестов`);
     - порядок в группе (опционально);
     - состояние чекбокса по умолчанию (включен/выключен);
     - родительская папка, где будет создан сценарий.
3. При вводе имени и кода действует проверка уникальности (дубликаты не допускаются).
4. После создания обновите панель (если вдруг список не обновился автоматически): `Refresh from disk` (`Обновить с диска`).
5. Добавьте вызовы вложенных сценариев в главные сценарии, начав вводить название этого сценария. IntelliSense предложит автозавершение строки.

## 5) Параметры: быстрый минимум

Что нужно для старта:

1. Объявляйте параметр в тексте как `[ParamName]`.
2. Передавайте его в вызов вложенного сценария строкой `ParamName = "Value"` (или `ParamName = [OtherParam]` для сквозной передачи).
3. Если параметр не передан явно, будет взят дефолт из `ПараметрыСценария -> Значение`.

Мини-пример:

```yaml
ТекстСценария: |
    #language: en

    And Create sales invoice
        DocumentNumber = "000000123"
        Counterparty   = [Counterparty]
```

Важно:

- если квадратные скобки нужны как обычный текст, экранируйте их: `\[` и `\]`;
- quick fix для `Missing parameters` может автоматически добавить отсутствующие параметры в вызов.

Подробно (включая многоуровневую передачу, дефолты, правила и подсказки переменных `$...$`):  
[`blocks/scenario-parameters.md`](./blocks/scenario-parameters.md)

## 6) Первый build

1. В Test Manager (`Менеджер тестов`) отметьте нужные главные сценарии.
2. Нажмите `Build tests` (`Собрать тесты`).
3. После завершения можете открыть feature-файлы или папку результатов из уведомления.

Результат:
- для выбранных тестов будут сформированы `.feature`;
- рядом будут подготовлены `.json` для запуска Vanessa.

## 7) Первый запуск теста в Vanessa

Есть два способа:

1. После завершения сборки, или если в директории уже содержится `.feature` нужного теста, будет иконка запуска рядом с конкретным сценарием (быстрый запуск).
2. В верхней части Test Manager (`Менеджер тестов`) есть кнопка запуска Vanessa с выбором режима:
   - автоматический режим (выбор теста для запуска);
   - режим отладки (открыть Vanessa без автопрогона, для ручной работы, с ручной загрузкой .feature).

## 8) Повседневная работа

Минимальный цикл:

1. Создаете/Редактируете тестовые сценарии.
2. Смотрите диагностику и применяете quick fix.
3. Сохраняете файл (авто-выравнивание и обновление служебных секций).
4. Собираете тесты `.feature`.
5. Запускаете нужный сценарий в Vanessa.
6. Изучаете результаты прохождения тестов.

## 9) Полезные команды контекстного меню

В YAML-редакторе нажмите ПКМ. Базовые быстрые действия:

- `KOT - Open scenario` (`KOT - Открыть сценарий`)
- `KOT - Find references to current scenario` (`KOT - Найти вызовы текущего сценария`)
- `KOT - Add or remove current scenario from favorites` (`KOT - Добавить/убрать открытый сценарий в избранное`)

Подменю `KOT - Work with files` (`KOT - Работа с файлами`) - появляется при вызове контекстного меню на выделенном тексте:

- `KOT - Open MXL file in editor` (`KOT - Открыть MXL файл в редакторе`)
- `KOT - Reveal file in VS Code Explorer` (`KOT - Показать файл в проводнике VS Code`)
- `KOT - Reveal file in OS file manager` (`KOT - Показать файл в системном проводнике`)

Подменю `KOT - Create...` (`KOT - Создать...`):

- `KOT - Create nested scenario` (`KOT - Создать вложенный сценарий`)
- `KOT - Create main scenario` (`KOT - Создать главный сценарий`)

Подменю `KOT - Editing` (`KOT - Редактирование`):

- `KOT - Fill NestedScenarios section` (`KOT - Заполнить секцию ВложенныеСценарии`)
- `KOT - Fill ScenarioParameters section` (`KOT - Заполнить секцию ПараметрыСценария`)
- `KOT - Fix scenario issues` (`KOT - Исправить проблемы сценария`)
- `KOT - Change nested scenario code` (`KOT - Изменить код вложенного сценария`)

## 10) Частые вопросы

### Почему не видны подсказки/команды?

Проверьте, что файл действительно сценарий (`ТипФайла: "Сценарий"`).

### Почему запуск сценария недоступен?

Сначала выполните `Build tests` (`Собрать тесты`), чтобы появились актуальные артефакты запуска.

### Почему текст в квадратных скобках попадает в параметры?

Если это не параметр, экранируйте скобки: `\[` и `\]`.

### Как искать шаги своими словами?

Используйте префикс `!` перед текстом поиска.  
Пример: `!условие, что открылось окно`, `!проверка фоновых заданий` и плагин предложит шаги из библиотеки шагов Vanessa Automation.

## 11) Что читать дальше

- Полная настройка: [`SETUP.md`](./SETUP.md)
- Детали по функциональным блокам: [`blocks/README.md`](./blocks/README.md)
- Архитектура и код: [`DEVELOPMENT.md`](./DEVELOPMENT.md)
